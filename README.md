<img width="150" height="150" align="left" style="float: left; margin: 0 10px 0 0;" alt="izms logo" src="docs/izms-logo_256x256.png">

# IZ*ONE Mail Shelter

IZ*ONE Mail Shelter (IZMS)ëŠ” ì•„ì´ì¦ˆì› í”„ë¼ì´ë¹— ë©”ì¼ ì•±ì—ì„œ ë°›ì€ ë©”ì¼ë“¤ì„ HTML í˜•ì‹ìœ¼ë¡œ ë¡œì»¬ì— ë‹¤ìš´ë¡œë“œí•˜ëŠ” íŒŒì´ì¬ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.

ì²« ì‹¤í–‰ í›„ì—ëŠ” ë¡œì»¬ì— ì„¤ì •í•œ ë°±ì—… ë””ë ‰í† ë¦¬ì™€ ì„œë²„ ë©”ì¼í•¨ê³¼ì˜ ì°¨ì´ë¥¼ ë¹„êµí•˜ì—¬ ìƒˆë¡œìš´ ë©”ì¼ë§Œ ì¶”ê°€ì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.
ë³¸ ë¦¬í¬ëŠ” ì•„ì´ì¦ˆì› í”„ë¼ì´ë¹— ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ `IZONEMail` í´ë˜ìŠ¤ì™€ ê·¸ê²ƒì„ ì´ìš©í•œ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ `izms.py`ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## Changelog

**2021.03.22**
- í•œêµ­ì–´ README ì¶”ê°€
- ì„¤ì • íŒŒì¼ ì´ë¦„ ë³€ê²½ `user_settings.json` â†’ `config.json`
- ë©”ì¼ ë‹¤ìš´ë¡œë“œ ìˆœì„œ ë³€ê²½ (ì œì¼ ì˜¤ë˜ëœ ë©”ì¼ë¶€í„°)
- Customizable ë©”ì¼ ì €ì¥ ê²½ë¡œ
- Standalone bundle ì œê³µ
- CSS, ì‚¬ì§„ ë³„ë„ ì €ì¥ ì˜µì…˜
- ë°±ì—… ë””ë ‰í† ë¦¬ë¥¼ ìŠ¤ìº”í•˜ì§€ ì•Šê³  ë³„ë„ì˜ INDEXë¥¼ í†µí•´ ë‹¤ìš´ë¡œë“œí•œ ë©”ì¼ ê´€ë¦¬
- Verbose error logs

## ì‹œì‘í•˜ê¸°

IZMSëŠ” ë‹¤ìŒ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
- Python 3.7~
- macOS 10.15~
- Windows 10
- Ubuntu 20.04 64-bit

### ë°©ë²•1: Standalone íŒ¨í‚¤ì§€

ë¯¸ë¦¬ ë¹Œë“œëœ ì‹¤í–‰ íŒŒì¼ì„ ì´ìš©í•˜ì—¬ íŒŒì´ì¬ì´ë‚˜ ê¸°íƒ€ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•˜ì§€ ì•Šê³  IZMSë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 1. IZMS ì‹¤í–‰íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° ì••ì¶• í’€ê¸° 

[IZMS ë¦´ë¦¬ì¦ˆ í˜ì´ì§€](https://github.com/coloriz/izone-mail-shelter/releases) ì—ì„œ ìì‹ ì˜ ìš´ì˜ì²´ì œì— ë§ëŠ” ë²„ì „ì„ ë‹¤ìš´ë°›ê³  ì••ì¶•ì„ í’‰ë‹ˆë‹¤.
> âš ï¸ ë‹¤ìš´ë°›ì„ ë•Œ ë¸Œë¼ìš°ì €ì— ë”°ë¼ ê²½ê³ ì°½ì´ ëœ¨ë©° ë‹¤ìš´ë¡œë“œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> ì´ê²ƒì€ IZMS ì‹¤í–‰íŒŒì¼ì´ ì¸ì¦ì„œë¡œ ì„œëª…ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë©°, 'ê³„ì†'ì„ ëˆŒëŸ¬ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> ì„œëª…ë˜ì§€ ì•Šì€ ì‹¤í–‰íŒŒì¼ì€ ì¼ë¶€ ë°±ì‹  í”„ë¡œê·¸ë¨ì—ì„œ ë°”ì´ëŸ¬ìŠ¤ë¡œ ì¸ì‹í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ë°±ì‹ ì—ì„œ ì˜ˆì™¸ ë“±ë¡ì„ í•˜ê±°ë‚˜ ë°©ë²•2ë¡œ ì‹œë„í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

#### 2. config.json ì„¤ì •

```json5
{
  // ...
  "profile": {
    "user-id": "ìœ ì € ID",
    "access-token": "ì•¡ì„¸ìŠ¤ í† í°",
    // ...
  }
}
```
ì‹¤í–‰ì„ ìœ„í•´ì„œëŠ” ë¨¼ì € ì„¤ì • íŒŒì¼ `config.json`ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
Charles, Wireshark, Burp Suiteë“±ì˜ SSL íŒ¨í‚· ìº¡ì²˜ íˆ´ì„ ì´ìš©í•˜ì—¬ ì•Œì•„ë‚¸ ìì‹ ì˜ `user-id`ì™€ `access-token`ì„ `config.json`ì— ì…ë ¥í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” `user-id`, `access-token`ì„ ì…ë ¥í•œ ì™„ì „í•œ `config.json`ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤.

**Example config.json**
```json
{
  "mail_path": "incoming/{member_id}/{mail_id}.html",
  "embed_css": false,
  "css_path": "../css",
  "image_to_base64": false,
  "image_path": "img",
  "profile": {
    "user-id": "57crzfhy4is0",
    "access-token": "klcr55c7000k82f1603oa6al",
    "os-type": "iOS",
    "terms-version": "5",
    "application-version": "1.2.3",
    "application-language": "ko"
  }
}
```

#### 3. ì‹¤í–‰

í„°ë¯¸ë„ì„ ì—´ê³  ì••ì¶•ì„ í‘¼ ê²½ë¡œë¡œ ì´ë™í•©ë‹ˆë‹¤. ìœˆë„ìš°ì˜ ê²½ìš° í„°ë¯¸ë„ì€ powershellì„ ì¶”ì²œí•©ë‹ˆë‹¤.
```shell
> cd "IZMS ê²½ë¡œ"
```

ì•±ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
```shell
> ./izms
```
![cmd_demo01](docs/cmd_demo01.gif)

ë§Œì•½ `user-id`ë‚˜ `access-token`ì„ ì˜ëª» ì…ë ¥í–ˆì„ ê²½ìš° 401 Unauthorized ì—ëŸ¬ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

#### 4. ë‹¤ìš´ë¡œë“œ ë°›ì€ ë©”ì¼ í™•ì¸í•˜ê¸°

ê¸°ë³¸ê°’ì„ ë°”ê¾¸ì§€ ì•Šìœ¼ë©´ ë©”ì¼ì€ `incoming/` í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.


### ë°©ë²•2: ì†ŒìŠ¤ì—ì„œ ì§ì ‘ ì‹¤í–‰

#### 1. Clone repo
```shell
> git clone https://github.com/coloriz/izone-mail-shelter.git
> cd izone-mail-shelter
```

#### 2. Install dependencies
```shell
> pip install -r requirements.txt
```

#### 3. config.json ì„¤ì •

ë°©ë²•1 ì°¸ì¡°.

#### 4. ì‹¤í–‰

```shell
> python izms.py
```


## ì„¤ì • ê°€ì´ë“œ

IZMS ì‹¤í–‰ì„ ìœ„í•´ì„  `config.json` íŒŒì¼ì´ ì‹¤í–‰íŒŒì¼ê³¼ ê°™ì€ ìœ„ì¹˜ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
`config.json` íŒŒì¼ ìˆ˜ì •ì„ í†µí•´ ë©”ì¼ ì €ì¥ ê²½ë¡œ, HTMLì— ì´ë¯¸ì§€ í¬í•¨ ì—¬ë¶€ ë“±ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì„¤ëª…ì„ ìœ„í•´ ì•„ë˜ ë©”ì¼ì„ ì˜ˆì‹œë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

```text
ë©”ì¼ID : m21937
ë©¤ë²„ì´ë¦„ : ë¯¸ì•¼ì™€í‚¤ ì‚¬ì¿ ë¼
ë©¤ë²„ID : 2
ìˆ˜ì‹ ì¼ì‹œ : 2021/03/22 10:46
ì œëª© : ğŸ¥ºğŸ’—ğŸŒ¸
```

### ë©”ì¼ ì €ì¥ ê²½ë¡œ

ë‹¤ìŒì€ `mail_path`ê°’ì„ ë³€ê²½í•˜ì—¬ ë©”ì¼ ì €ì¥ ê²½ë¡œë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ëŠ” ëª‡ ê°€ì§€ ì˜ˆì‹œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

**ë©¤ë²„IDë¡œ í´ë” ë¶„ë¥˜, ë©”ì¼IDë¡œ ì €ì¥ (ê¸°ë³¸ê°’)**
```json5
{
  "mail_path": "incoming/{member_id}/{mail_id}.html"
}
// ë©”ì¼ ì €ì¥ ê²½ë¡œ : incoming/2/m21937.html
```

**ë©¤ë²„IDê°€ ì•„ë‹Œ ë©¤ë²„ì´ë¦„ í´ë”ì— ì €ì¥**
```json5
{
  "mail_path": "incoming/{member_name}/{mail_id}.html"
}
// ë©”ì¼ ì €ì¥ ê²½ë¡œ : incoming/ë¯¸ì•¼ì™€í‚¤ ì‚¬ì¿ ë¼/m21937.html
```

**ë©”ì¼ ìˆ˜ì‹ ì¼ê³¼ ì œëª©ì„ íŒŒì¼ëª…ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°**
```json5
{
  "mail_path": "incoming/{member_name}/{received:%Y%m%d}_{subject}.html"
}
// ë©”ì¼ ì €ì¥ ê²½ë¡œ : incoming/ë¯¸ì•¼ì™€í‚¤ ì‚¬ì¿ ë¼/20210322_ğŸ¥ºğŸ’—ğŸŒ¸.html
```
> ë©”ì¼ ì œëª©ì— ì´ëª¨ì§€ê°€ í¬í•¨ë˜ì–´ ìˆëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê²½ìš°ì— ë”°ë¼ ìš´ì˜ì²´ì œëŠ” ì´ëª¨ì§€ê°€ ë“¤ì–´ê°„ íŒŒì¼ëª…ì„ ì œëŒ€ë¡œ í•¸ë“¤ë§í•˜ì§€ ëª» í•  ìˆ˜ ìˆìœ¼ë‹ˆ
> ë©”ì¼ ì œëª©ì„ íŒŒì¼ëª…ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê·¸ë‹¤ì§€ ì¶”ì²œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ë©”ì¼ì„ ë©¤ë²„ ë‹¨ìœ„ê°€ ì•„ë‹Œ ìˆ˜ì‹ ì¼ë¡œ ë¶„ë¥˜í•˜ê¸°**
```json5
{
  "mail_path": "incoming/{received:%Y%m%d}/{mail_id}.html"
}
// ë©”ì¼ ì €ì¥ ê²½ë¡œ : incoming/20210322/m21937.html
```

### ì´ë¯¸ì§€, CSS ì„ë² ë”© ì—¬ë¶€

**ì´ë¯¸ì§€ì™€ CSSë¥¼ ë³„ë„ ê²½ë¡œì— ì €ì¥ (ê¸°ë³¸ê°’)**
```json5
{
  "embed_css": false,
  "css_path": "../css",
  "image_to_base64": false,
  "image_path": "img"
}
// ë©”ì¼ì´ incoming/2/m21937.htmlì— ì €ì¥ë  ë•Œ,
// CSS ì €ì¥ ê²½ë¡œ : incoming/css/
// ì´ë¯¸ì§€ ì €ì¥ ê²½ë¡œ : incoming/2/img/
```

**ì´ë¯¸ì§€ì™€ CSSë¥¼ HTML ì•ˆì— í¬í•¨ì‹œí‚¤ê¸°**
```json5
{
  "embed_css": true,
  "image_to_base64": true,
  // css_path, image_pathëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
}
```
ì´ ê²½ìš° ëª¨ë“  ì •ë³´ê°€ HTML íŒŒì¼ ì•ˆì— í¬í•¨ë˜ë¯€ë¡œ ë‚˜ì¤‘ì— HTML íŒŒì¼ ìœ„ì¹˜ë¥¼ ë°”ê¿”ë„ ë ˆì´ì•„ì›ƒì´ë‚˜ ì´ë¯¸ì§€ê°€ ê¹¨ì§€ì§€ ì•ŠëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.


## Appendix

### `INDEX`, `HEAD` íŒŒì¼ì— ëŒ€í•´
ì²« ì‹¤í–‰ì‹œ ìƒì„±ë˜ëŠ” ë©”íƒ€ë°ì´í„° íŒŒì¼ë¡œì¨ ë¡œì»¬ì— ë‹¤ìš´ë¡œë“œí•œ ë©”ì¼ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
ë§Œì•½ ì„¤ì • íŒŒì¼ ë³€ê²½ ë“±ì˜ ì´ìœ ë¡œ ë°±ì—…ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê³ ì í•˜ëŠ” ê²½ìš° ë‹¤ìš´ë¡œë“œ í´ë”ì™€ ì´ ë‘ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. 

### `config.json`
ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤. ì‹¤í–‰íŒŒì¼ê³¼ ê°™ì€ í´ë”ì— ìœ„ì¹˜í•´ì•¼í•©ë‹ˆë‹¤. ìœ íš¨í•œ keyëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

#### `mail_path` (`str`, required)
ë©”ì¼ ì €ì¥ ê²½ë¡œ í…œí”Œë¦¿ì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ì¹˜í™˜ê°€ëŠ¥í•œ ë³€ìˆ˜ë“¤ì´ ìˆìŠµë‹ˆë‹¤.
- `{member_id}`: ë©¤ë²„ ID (`str`)
- `{member_name}`: ë©¤ë²„ ì´ë¦„ (`str`)
- `{mail_id}`: ë©”ì¼ ID (`str`)
- `{received}`: ë©”ì¼ ìˆ˜ì‹ ì¼ì‹œ (`datetime`)
- `{subject}`: ë©”ì¼ ì œëª© (`str`)

#### `embed_css` (`bool`, default: False)
CSSë¥¼ ë©”ì¼ HTMLì— í¬í•¨ì‹œí‚µë‹ˆë‹¤.

#### `css_path` (`str`, default: '../css')
`embed_css`ê°€ `true`ì¼ ê²½ìš° CSSë¥¼ ì €ì¥í•  HTML íŒŒì¼ì— ëŒ€í•œ ìƒëŒ€ê²½ë¡œì…ë‹ˆë‹¤.

#### `image_to_base64` (`bool`, default: False)
ë©”ì¼ì˜ ì´ë¯¸ì§€ë¥¼ HTMLì— base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ ë‚´ì¥í•©ë‹ˆë‹¤.

#### `image_path` (`str`, default: 'img')
`image_to_base64`ê°€ `true`ì¼ ê²½ìš° ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  HTML íŒŒì¼ì— ëŒ€í•œ ìƒëŒ€ê²½ë¡œì…ë‹ˆë‹¤.

#### `profile` (`object`, required)
REST API ìš”ì²­ì— ì‚¬ìš©ë˜ëŠ” í—¤ë”ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. keyëŠ” ëª¨ë‘ ì†Œë¬¸ìì…ë‹ˆë‹¤.
  - `user-id`: ìœ ì € ID
  - `access-token`: ì•¡ì„¸ìŠ¤ í† í°
  - `terms-version`: ì•½ê´€ ë™ì˜ ë²„ì „ ("5")
  - `os-type`: ëª¨ë°”ì¼ ìš´ì˜ì²´ì œ íƒ€ì… ["iOS", "android"]
  - `application-version`: í”„ë©”ì•± ë²„ì „ iOS: "1.2.3", android: "1.4.5" (ì‘ì„±ì¼(2021.03.22) ê¸°ì¤€)
  - `application-language`: ì•± ì–¸ì–´ ["ko", "ja", "en"] (ë©¤ë²„ ì´ë¦„ ì–¸ì–´ë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŒ)


  - ê¸°íƒ€ optional header: `device-version`, `os-version`
  - ê¸°íƒ€ HTTP header: `user-agent`, `accept-encoding`, `accept`, `accept-encoding`, `accept-language`

#### `timeout` (`float`, default: 5)
HTTP ìš”ì²­ timeout (ì´ˆ)

#### `max_retries` (`int`, default: 3)
HTTP ìš”ì²­ ì‹¤íŒ¨ì‹œ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜

#### `finish_hook` (`str`)
í”„ë¡œê·¸ë¨ ì¢…ë£Œì‹œ í˜¸ì¶œë  í•¸ë“¤ëŸ¬ ê²½ë¡œ (args: "program name" "num of downloaded mails")
